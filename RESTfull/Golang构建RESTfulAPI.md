# Golang 构建 RESTful API

## RESTful API 介绍

什么是 API

API（Application Programming Interface，应用程序编程接口）是一些预先定义的函数或者接口，目的是提供应用程序与开发人员基于某软件或硬件得以访问一组例程的能力，而又无须访问源码，或理解内部工作机制的细节。

Go 语言中常用的 API 风格是 RPC 和 REST，常用的媒体类型是 JSON、XML 和 Protobuf。在 Go API 开发中常用的组合是 gRPC + Protobuf 和 REST + JSON。

## REST 简介

REST 规范中有如下几个核心：

1.  REST 中一切实体都被抽象成资源，每个资源有一个唯一的标识 —— URI，所有的行为都应该是在资源上的 CRUD 操作
2.  使用标准的方法来更改资源的状态，常见的操作有：资源的增删改查操作
3.  无状态：这里的无状态是指每个 RESTful API 请求都包含了所有足够完成本次操作的信息，服务器端无须保持 Session

>   无状态对于服务端的弹性扩容是很重要的。

| HTTP 方法 | 行为                     | URI          | 示例说明                  |
| --------- | ------------------------ | ------------ | ------------------------- |
| GET       | 获取资源列表             | /users       | 获取用户列表              |
| GET       | 获取一个具体的资源       | /users/admin | 获取 admin 用户的详细信息 |
| POST      | 创建一个新的资源         | /users       | 创建一个新用户            |
| PUT       | 以整体的方式更新一个资源 | /users/1     | 更新 id 为 1 的用户       |
| DELETE    | 删除服务器上的一个资源   | /users/1     | 删除 id 为 1 的用户       |

## REST vs RPC

RPC 相比 REST 的优点主要有 3 点：

1.  RPC+Protobuf 采用的是 TCP 做传输协议，REST 直接使用 HTTP 做应用层协议，这种区别导致 REST 在调用性能上会比 RPC+Protobuf 低
2.  RPC 不像 REST 那样，每一个操作都要抽象成对资源的增删改查，在实际开发中，有很多操作很难抽象成资源，比如登录操作。所以在实际开发中并不能严格按照 REST 规范来写 API，RPC 就不存在这个问题
3.  RPC 屏蔽网络细节、易用，和本地调用类似

REST 相较 RPC 也有很多优势：

1.  轻量级，简单易用，维护性和扩展性都比较好
2.  REST 相对更规范，更标准，更通用，无论哪种语言都支持 HTTP 协议，可以对接外部很多系统，只要满足 HTTP 调用即可，更适合对外，RPC 会有语言限制，不同语言的 RPC 调用起来很麻烦
3.  JSON 格式可读性更强，开发调试都很方便
4.  在开发过程中，如果严格按照 REST 规范来写 API，API 看起来更清晰，更容易被大家理解

业界普遍采用的做法是，内部系统之间调用用 RPC，对外用 REST，因为内部系统之间可能调用很频繁，需要 RPC 的高性能支撑。对外用 REST 更易理解，更通用些。

## 媒体类型选择

HTTP 的 REST 能够提供多种不同的响应形式，常见的是 XML 和 JSON。JSON 无论从形式上还是使用方法上都更简单。内容更加紧凑，数据展现形式直观易懂，开发测试都非常方便

