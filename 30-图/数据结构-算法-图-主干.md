# 图

[TOC]

## 基础

顶点（vertex）：图中的元素

边（edge）：一个顶点可以与任意其他顶点建立连接关系，这种建立的关系。

度：跟顶点相连接的边的条数。

有向图：边 有方向的图

无向图：边 无方向的图

顶点的入度：有多少条边指向这个顶点；（有向图）

顶点的出度：有多少条边是以这个顶点为起点指向其他顶点。（有向图）

带权图：每条边都有一个权重（weight）

![1553604788831](D:\Documents\笔记本\offer学习复习\图\1553604788831.png)

![1553604618431](D:\Documents\笔记本\offer学习复习\图\1553604618431.png)

![1553604776073](D:\Documents\笔记本\offer学习复习\图\1553604776073.png)

## 邻接矩阵存储方法

它是图最直观的一种存储方法，底层依赖一个二维数组。

对于无向图来说，如果顶点i与顶点j之间有边，我们就将 A[ i ]\[ j \] 和 A[ j ]\[ i \] 标记为 1；

对于有向图来说，如果顶点  i  到顶点  j  之间，有一条箭头从顶点i指向顶点  j  的边，那我们就将 A[ i ]\[ j \] 标记为1。

如果有一条箭头从顶点j指向顶点i的边，我们就将 A[ j ]\[ i \] 标记为1。对于带权图，数组中就存储相应的权重。

![1553604869512](D:\Documents\笔记本\offer学习复习\图\1553604869512.png)

利弊：

这样的方式较浪费存储空间。大多数情况只需要其一般的空间。如果我们存储的是稀疏图（Sparse Matrix），也就是说，顶点很多，但每个顶点的边并不多，那邻接矩阵的存储方法就更加浪费空间了。

邻接矩阵的存储方式简单、直接。因为基于数组，所以在获取两个顶点的关系时，就非常高效。其次，用邻接矩阵存储图的另外一个好处是方便计算。

## 邻接表存储方法

每个顶点对应一条链表，链表中存储的是与这个顶点相连接的其他顶点。

有向图的邻接表存储方式，每个顶点对应的链表里面，存储的是指向的顶点。对于无向图来说，也是类似的，不过，每个顶点的链表中存储的，是跟这个顶点有边相连的顶点。

![1553605229832](D:\Documents\笔记本\offer学习复习\图\1553605229832.png)

利弊

邻接矩阵存储起来比较浪费空间，但是使用起来比较节省时间。相反，邻接表存储起来比较节省空间，但是使用起来就比较耗时间。

在基于链表法解决冲突的散列表中，如果链过长，为了提高查找效率，我们可以将链表换成其他更加高效的数据结构，比如平衡二又查找树等。

## 场景

如何存储微博、微信等社交网络中的好友关系？

针对微博用户关系，假设我们需要支持下面这样几个操作：

-   判断用户 A 是否关注了用户 B；
-   判断用户 A 是否是用户B的粉丝；
-   用户 A 关注用户 B；
-   用户 A 取消关注用户 B；
-   根据用户名称的首字母排序，分页获取用户的粉丝列表；
-   根据用户名称的首字母排序，分页获取用户的关注列表。

用一个邻接表来存储这种有向图是不够的。我们去查找某个用户关注了哪些用户非常容易，但是如果要想知道某个用户都被哪些用户关注了，也就是用户的粉丝列表，是非常困难的。

基于此，我们需要一个逆邻接表。邻接表中存储了用户的关注关系，逆邻接表中存储的是用户的被关注关系。对应到图上，邻接表中，每个顶点的链表中，存储的就是这个顶点指向的顶点，逆邻接表中，每个顶点的链表中，存储的是指向这个顶点的顶点。如果要查找某个用户关注了哪些用户，我们可以在邻接表中查找；如果要查找某个用户被哪些用户关注了，我们从逆邻接表中查找。

![1553605410268](D:\Documents\笔记本\offer学习复习\图\1553605410268.png)

基础的邻接表不适合快速判断两个用户之间是否是关注与被关注的关系，所以我们选择改进版本，将邻接表中的链表改为支持快速查找的动态数据结构。选择哪种动态数据结构呢？

因为我们需要按照用户名称的首字母排序，分页来获取用户的粉丝列表或者关注列表，用跳表这种结构再合适不过了。这是因为，跳表插入、删除、查找都非常高效，时间复杂度是O（logn），空间复杂度上稍高，是O（n）。最重要的一点，跳表中存储的数据本来就是有序的了，分页获取粉丝列表或关注列表，就非常高效。

如果对于小规模的数据，比如社交网络中只有几万、几十万个用户，我们可以将整个社交关系存储在内存中，上面的解决思路是没有问题的。

但是如果像微博那样有上亿的用户，数据规模太大，我们就无法全部存储在内存中了。这个时候该怎么办呢？我们可以通过哈希算法等数据分片方式，将邻接表存储在不同的机器上。

![1553605510818](D:\Documents\笔记本\offer学习复习\图\1553605510818.png)

有另外一种解决思路，就是利用外部存储（比如硬盘），因为外部存储的存储空间要比内存会宽裕很多。数据库是我们经常用来持久化存储关系数据的，所以我这里介绍一种数据库的存储方式。

为了高效地支持前面定义的操作，我们可以在表上建立多个索引，比如第一列、第二列，给这两列都建立索引。

![1553605547067](D:\Documents\笔记本\offer学习复习\图\1553605547067.png)

## 总结

图这种非线性表数据结构，关于图，你需要理解这样几个概念：无向图、有向图、带权图、顶点、边、度、入度、出度。除此之外，我们还学习了图的两个主要的存储方式：邻接矩阵和邻接表。

邻接矩阵存储方法的缺点是比较浪费空间，但是优点是查询效率高，而且方便矩阵运算。邻接表存储方法中每个顶点都对应一个链表，存储与其相连接的其他顶点。尽管邻接表的存储方式比较节省存储空间，但链表不方便查找，所以查询效率没有邻接矩阵存储方式高。针对这个问题，邻接表还有改进升级版，即将链表换成更加高效的动态数据结构，比如平衡二叉查找树、跳表、散列表等。

## 思考

1，关于开篇思考题，我们只讲了微博这种有向图的解决思路，那像微信这种无向图，应该怎么存储呢？你可以照着我的思路，自己做一下练习。

微信好友关系存储方式。无向图，也可以使用邻接表的方式存储每个人所对应的好友列表。为了支持快速查找，好友列表可以使用红黑树存储。

2，除了我今天举的社交网络可以用图来表示之外，符合图这种结构特点的例子还有很多，比如知识图谱（Knowledge Graph）。关于图这种数据结构，你还能想到其他生活或者工作中的例子吗？

生活工作中应用图的例子。很多，互联网上网页之间通过超链接连接成一张有向图；城市乃至全国交通网络是一张加权图；人与人之间的人际关系够成一张图，著名的六度分割理论据说就是基于这个得到的。