# 23丨索引的概览：用还是不用索引

[TOC]

## 疑问

什么情况下创建索引，什么时候不需要索引？

索引的种类有哪些？

## 索引是万能的吗？

什么是索引（Index）？

数据库中的索引，就好比一本书的目录，它可以帮我们快速进行特定值的定位与查找，从而加快数据查询的效率。

索引概览

-   索引就是帮助数据库管理系统高效获取数据的数据结构。
-   索引不是万能的，在有些情况下使用索引反而会让效率变低。
    -   使用索引不仅要看字段中的数值个数，还要根据数值的分布情况来考虑是否需要。
-   索引的价值是帮我们从海量数据中找到想要的数据（数据量少，是否使用索引对结果的影响并不大。）

## 索引的种类有哪些？

从功能逻辑上说，索引主要有 4 种，分别是普通索引、唯一索引、主键索引和全文索引。

-   普通索引是基础的索引，没有任何约束，主要用于提高查询效率。
-   唯一索引就是在普通索引的基础上增加了数据唯一性的约束，在一张数据表里可以有多个唯一索引。
-   主键索引在唯一索引的基础上增加了不为空的约束，也就是 NOT NULL+UNIQUE，一张表里最多只有一个主键索引（解析只能有一个：因为数据存储在文件中只能按照一种顺序进行存储）。
-   全文索引用的不多，MySQL 自带的全文索引只支持英文。

按照物理实现方式，索引可以分为 2 种：聚集索引和非聚集索引。非聚集索引称为二级索引或者辅助索引。

-   聚集索引可以按照主键来排序存储数据，对查找行很有效。等找到了索引的位置，在它后面就是我们想要找的数据行。
    -   只有当表包含聚集索引时，表内的数据行才会按找索引列的值在磁盘上进行物理排序和存储。
    -   每一个表只能有一个聚集索引，因为数据行本身只能按一个顺序存储。
-   在数据库系统会有单独的存储空间存放非聚集索引，这些索引项是按照顺序存储的，但索引项指向的内容是随机存储的。
    -   也就是说系统会进行两次查找，第一次先找到索引，第二次找到索引对应的位置取出数据行。
    -   非聚集索引会维护单独的索引表（只维护索引，不维护索引指向的数据），为数据检索提供方便。

聚集索引与非聚集索引的原理不同，在使用上也有一些区别：

-   聚集索引的叶子节点存储的就是我们的数据记录，非聚集索引的叶子节点存储的是数据位置。非聚集索引不会影响数据表的物理存储顺序。
-   一个表只能有一个聚集索引，因为只能有一种排序存储的方式，但可以有多个非聚集索引，也就是多个索引目录提供数据检索。
-   使用聚集索引的时候，数据的查询效率高，但如果对数据进行插入，删除，更新等操作，效率会比非聚集索引低。

索引还可以按照字段个数进行划分，分成单一索引和联合索引。

-   索引列为一列时为单一索引；多个列组合在一起创建的索引叫做联合索引。

## 相关实验

### 实验 1：数据行数少的情况下，索引效率如何

在数据量不大的情况下，索引发挥不出作用。

### 实验 2：性别（男或女）字段真的不应该创建索引吗？

不仅要看字段中的数值个数，还要根据数值的分布情况来考虑是否需要创建索引

### 实验 3：使用聚集索引和非聚集索引的查询效率

通过上面三次查询，总结出以下两点内容：

-   对 WHERE 子句的字段建立索引，可以大幅提升查询效率。
-   采用聚集索引进行数据查询，比使用非聚集索引的查询效率略高。如果查询次数比较多，还是尽量使用主键索引进行数据查询。

创建联合索引时，我们需要注意创建时的顺序问题，因为联合索引 (x, y, z) 和 (z, y, x) 在使用的时候效率可能会存在差别。

-   联合索引存在最左匹配原则，也就是按照最左优先的方式进行索引的匹配。

### 实验 4：联合索引的最左原则

## 总结

当我们使用索引时，需要平衡索引的利（提升查询效率）和弊（维护索引所需的代价）。比如占用存储空间、降低数据库写操作的性能等